META-DATA(8)		    System Manager's Manual		  META-DATA(8)

NAME
     meta-data - meta-data server for OpenBSD's virtual machine daemon

SYNOPSIS
     meta-data bridge

DESCRIPTION
     The meta-data FastCGI program provides a cloud-init datasource for
     OpenBSD's vmd(8) that is compatible to Apache CloudStack and partially to
     Amazon EC2.

     1.	  Create the meta-data directory and add the _meta-data user

		# mkdir -p /home/vm/meta-data
		# groupadd -g 787 _meta-data
		# useradd -g 787 -u 787 -k /var/empty -d /home/vm/meta-data \
			-s /sbin/nologin -c "meta-data user" _meta-data

     2.	  Use the kfcgi(8) FastCGI server to run meta-data.  Start it as root
	  and with chroot disabled as meta-data will drop privileges by
	  itself.  The meta-data socket has to be owned by the "www" user of
	  the web server.

		# kfcgi -r -n 2 -u www -p / -- /usr/local/libexec/meta-data bridge0

     3.	  Configure and start httpd(8) to handle meta-data requests.

		server "meta-data" {
			listen on 0.0.0.0 port 80
			location "/latest*" {
				fastcgi socket "/run/httpd.sock"
				root { "/", strip 1 }
			}
		}

FILES
     /home/vm/meta-data/openbsd.vm   Directory containing meta-data for the
				     virtual machine "openbsd.vm".
     openssh-key		     The SSH public key in the VM's meta-data
				     directory.
     user-data			     "user-data" file in the VM's meta-data
				     directory.
     username			     The login username (this is an
				     extension).

SEE ALSO
     kfcgi(8), kcgi(8), vmd(8)

     User-Data and Meta-Data,
     http://docs.cloudstack.apache.org/projects/cloudstack-administration/en/latest/virtual_machines.html#user-data-and-meta-data.

AUTHORS
     Reyk Floeter <reyk@openbsd.org>

OpenBSD 6.0		       February 25, 2017		   OpenBSD 6.0
